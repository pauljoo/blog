---
title: Linux-内存管理
date: 2018-10-01 11:28:00
categories:
- 操作系统
tags:
- Linux
---

## 页
内核把物理页作为内存管理的基本单位。尽管处理器的最小可寻址单位通常为字，但是，内存管理单元(MMU，管理内存并把虚拟地址装换为物理地址的硬件)通常以页为单位进行处理。从虚拟内存的角度来看，页就是最小单位。

大多数32位体系结构支持4KB的页，而64位体系结构一般会支持8KB的页。这就意味着，在支持4KB页大小并有1GB物理内存的机器上，物理内存会被划分为262144个页。

## 区

由于硬件的限制，内核并不能对所有的页一视同仁。有些页位于内存中特定的物理地址上，所以不能将其用于一些特定的任务。由于存在这种限制，所以内核把页划分为不同的区(zone)。内核使用区对具有相似特性的页进行分组。Linux必须处理如下两种由于硬件存在缺陷而引起的内存寻址问题。
1. 一些硬件只能用某些特定的内存地址来执行DMA（直接内存访问）。
2. 一些体系结构的内存的物理寻址范围比虚拟寻址范围大得多。这样，就有一些内存不能永久的映射到内核空间上。

Linux主要使用了四种区：
- ZONE_DMA：这个区包含的页能用来执行DMA操作。
- ZONE_DMA32：与ZONE_DMA不同之处在于这些页面只能被32位设备访问。
- ZONE_NORMAL：这个区包含的都是能正常映射的页。
- ZONE_HIGHMEM：这个区包含“高端内存”，其中的页并不能永久地映射到内核地址空间。

区的实际使用和分布是与体系结构相关的。区的划分没有任何物理意义，这只不过是内核为了管理页而采取的一种逻辑上的分组。

### x86-32上的区

|区|描述|物理内存|
|-|-|-|
|ZONE_DMA|DMA使用的页|<16MB|
|ZONE_NORMAL|正常可寻址的页|16-896M|
|ZONE_HIGHMEM|动态映射的页|>896M|

## 页的操作

内核是完全信赖自己的。这点与用户空间不同，如果你有非法操作，内核会开开心心的把自己挂起来，停止运行。

获得页：```alloc_pages```
释放页：```free_pages```